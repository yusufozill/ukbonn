<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Button and Output Example</title>
    <style>
        .container {
            display: flex;
            flex-wrap: wrap;
        }
        .box {
            margin: 10px;
        }
        button {
            margin-bottom: 5px;
            padding: 10px;
        }
        output {
            display: block;
            margin-top: 5px;
        }
    </style>
</head>
<script>
    function getFlightTimes(args) {
    // this is where you would validate the arguments you received
    const departure = args.departure;
    const arrival = args.arrival;

    const flights = {
        "NYC-LAX": { departure: "08:00 AM", arrival: "11:30 AM", duration: "5h 30m" },
        "LAX-NYC": { departure: "02:00 PM", arrival: "10:30 PM", duration: "5h 30m" },
        "LHR-JFK": { departure: "10:00 AM", arrival: "01:00 PM", duration: "8h 00m" },
        "JFK-LHR": { departure: "09:00 PM", arrival: "09:00 AM", duration: "7h 00m" },
        "CDG-DXB": { departure: "11:00 AM", arrival: "08:00 PM", duration: "6h 00m" },
        "DXB-CDG": { departure: "03:00 AM", arrival: "07:30 AM", duration: "7h 30m" }
    };

    const key = `${departure}-${arrival}`.toUpperCase();
    return JSON.stringify(flights[key] || { error: "Flight not found" });
}
  
var messages = [
    {
        role: "user",
        content: 'What is the flight time from New York (NYC) to Los Angeles (LAX)?'
    }
];
async function callOllama() {
    
    const url = 'http://localhost:11434/api/chat';
    var modelName = "llama3.2";

    var tools = [
        {
            type: 'function',
            function: {
                name: 'get_flight_times',
                description: 'Get the flight times between two cities',
                parameters: {
                    type: 'object',
                    properties: {
                        departure: {
                            type: 'string',
                            description: 'The departure city (airport code)',
                        },
                        arrival: {
                            type: 'string',
                            description: 'The arrival city (airport code)',
                        },
                    },
                    required: ['departure', 'arrival'],
                },
            },
        },
    ];

    const data = {
        model: modelName,
        messages: messages,
        stream: false,
        tools: tools
    };

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if (response.ok) {
            const result = await response.json();
            messages.push(result.message);

            if (!result.message.tool_calls || result.message.tool_calls.length === 0) {
                console.log("The model did NOT use the function. Its response was:");
                console.log(result.message.content);
                return result;
            } else {
                console.log("The model USED the function. Its response was:");
                console.log(result.message.content);


                const availableFunctions = {
                    get_flight_times: getFlightTimes,
                };
                for (const tool of result.message.tool_calls) {
                    const functionToCall = availableFunctions[tool.function.name];
                    const functionResponse = functionToCall(tool.function.arguments);
                    // Add function response to the conversation
                    messages.push({
                        role: 'tool',
                        content: functionResponse,
                    });
                }
                // Second API call: Get final response from the model
                return await callOllama();
            }

        } else {
            console.log(`Error: ${response.status} ${response.statusText}`);
        }
    } catch (error) {
        console.error(`Request failed: ${error.message}`);
    }
}
</script>
<body>
    <div class="container">
        <div class="box">
            <button onclick="callOllama();">Button 1</button>
            <output id="output1"></output>
        </div>
        <div class="box">
            <button onclick="calliki">Button 2</button>
            <output id="output2"></output>
        </div>
        <div class="box">
            <button onclick="document.getElementById('output3').value = 'Button 3 clicked!'">Button 3</button>
            <output id="output3"></output>
        </div>
        <div class="box">
            <button onclick="document.getElementById('output4').value = 'Button 4 clicked!'">Button 4</button>
            <output id="output4"></output>
        </div>
        <div class="box">
            <button onclick="document.getElementById('output5').value = 'Button 5 clicked!'">Button 5</button>
            <output id="output5"></output>
        </div>
        <div class="box">
            <button onclick="document.getElementById('output6').value = 'Button 6 clicked!'">Button 6</button>
            <output id="output6"></output>
        </div>
    </div>
</body>
</html>
